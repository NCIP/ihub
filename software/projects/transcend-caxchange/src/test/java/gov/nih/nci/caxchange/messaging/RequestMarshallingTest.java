package gov.nih.nci.caxchange.messaging;

import gov.nih.nci.integration.util.JAXBMarshaller;

import java.io.PrintWriter;
import java.io.StringReader;
import java.io.StringWriter;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBElement;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.bind.Unmarshaller;
import javax.xml.namespace.QName;

import org.junit.Test;

public class RequestMarshallingTest {

    // @Test
    public void marshallMessage() throws JAXBException {
        Object obj = unmarshall(getMessage(), Message.class);
        // System.out.println(obj);

        Message msg = ((JAXBElement<Message>) obj).getValue();
        // System.out.println(msg);
        JAXBMarshaller jm = new JAXBMarshaller();

        QName qname = new QName("http://caXchange.nci.nih.gov/caxchangerequest", "caxchangerequest");
        JAXBElement<Message> message = new JAXBElement<Message>(qname, Message.class, msg);
        String s = marshal(message, Message.class);
        // System.out.println(s);
    }

    @Test
    public void marshallError() throws JAXBException {
        ErrorDetails errorDetails = new ErrorDetails();
        errorDetails.setErrorCode("EC");
        errorDetails.setErrorDescription("ED");
        Response response = new Response();
        response.setCaXchangeError(errorDetails);
        response.setResponseStatus(Statuses.FAILURE);

        QName qname = new QName("http://caXchange.nci.nih.gov/messaging", "response");

        JAXBElement<Response> respJ = new JAXBElement<Response>(qname, Response.class, response);

        String xml = marshal(respJ, Response.class);
        // System.out.println(xml);

        QName ceQname = new QName("http://caXchange.nci.nih.gov/messaging", "caXchangeError");
        JAXBElement<ErrorDetails> edJ = new JAXBElement<ErrorDetails>(ceQname, ErrorDetails.class, errorDetails);
        xml = marshal(edJ, ErrorDetails.class);
        // System.out.println(xml);
    }

    /**
     * Marshals Object to its xml format, based on its context
     * 
     * @param obj - object to be marshalled
     * @return marshalled string
     * @throws JAXBException exception thrown, if any
     */
    public Object unmarshall(String xmlstr, Class claz) throws JAXBException {
        final JAXBContext jc = JAXBContext.newInstance(claz);

        final Unmarshaller m = jc.createUnmarshaller();
        return m.unmarshal(new StringReader(xmlstr));
    }

    public String marshal(Object obj, Class claz) throws JAXBException {
        final JAXBContext jc = JAXBContext.newInstance(claz);

        final Marshaller m = jc.createMarshaller();
        final StringWriter sw = new StringWriter();
        final PrintWriter pw = new PrintWriter(sw);
        m.marshal(obj, pw);

        return sw.toString();
    }

    private String getMessage() {
        return "<mes:caXchangeRequestMessage xmlns:mes=\"http://caXchange.nci.nih.gov/messaging\"><mes:metadata><mes:transactionControl>?</mes:transactionControl><mes:serviceType>iHub</mes:serviceType><!--Optional:--><mes:operationName>UPDATEREGISTRATION</mes:operationName><mes:externalIdentifier>34349179</mes:externalIdentifier><!--Optional:--><mes:caXchangeIdentifier></mes:caXchangeIdentifier><!--Optional:--><mes:credentials><!--You have a CHOICE of the next 3 items at this level--><mes:userName>tolvenuser</mes:userName><mes:groupName>nogrid</mes:groupName><mes:gridIdentifier>nogrid</mes:gridIdentifier><!--Optional:--><mes:password>changeme</mes:password><!--Optional:--><mes:delegatedCredentialReference>nocredentials</mes:delegatedCredentialReference></mes:credentials></mes:metadata><mes:request><mes:businessMessagePayload><mes:xmlSchemaDefinition>urn:tolven-org:trim:4.0</mes:xmlSchemaDefinition><ns1trim:trim xmlns:ns1trim=\"urn:tolven-org:trim:4.0\"><ns1trim:extends>patientAct</ns1trim:extends><ns1trim:name>obs/evn/registration</ns1trim:name><ns1trim:description>Registration</ns1trim:description><ns1trim:page>registration.xhtml</ns1trim:page><ns1trim:drilldown>registrationDD.xhtml</ns1trim:drilldown><ns1trim:menu>global:caseReportFormMenu</ns1trim:menu><ns1trim:tolvenEventId accountId=\"47003\" application=\"echr\" id=\"2672224\" path=\"echr:patient-2003014:caseReportForm-2672224\" principal=\"sarah.davis@ucsfmedctr.org\" timestamp=\"20120308213121+0000\"/><ns1trim:reference>http://wikihit.org/wiki/index.php</ns1trim:reference><ns1trim:application name=\"echr\" signatureRequired=\"true\"><ns1trim:instance>echr:patient:caseReportForm</ns1trim:instance><ns1trim:wip>echr:activity:all</ns1trim:wip></ns1trim:application><ns1trim:act classCode=\"OBS\" moodCode=\"EVN\"><ns1trim:label>Registration</ns1trim:label><ns1trim:bind application=\"echr\" phase=\"create\"><ns1trim:placeholder bindAction=\"merge\"><ns1trim:path>echr:patient:caseReportForm</ns1trim:path></ns1trim:placeholder></ns1trim:bind><ns1trim:id><ns1trim:II><ns1trim:root>1.2.1.47003</ns1trim:root><ns1trim:extension>echr:patient-2003014:caseReportForm-2672221</ns1trim:extension></ns1trim:II></ns1trim:id><ns1trim:code><ns1trim:CD><ns1trim:code>OINT</ns1trim:code><ns1trim:codeSystemName>HL7</ns1trim:codeSystemName><ns1trim:codeSystemVersion>3.0</ns1trim:codeSystemVersion></ns1trim:CD></ns1trim:code><ns1trim:statusCode>active</ns1trim:statusCode><ns1trim:title><ns1trim:ST>Registration</ns1trim:ST></ns1trim:title><ns1trim:effectiveTime><ns1trim:label>Date</ns1trim:label><ns1trim:new datatype=\"TS\" function=\"now\"/><ns1trim:TS><ns1trim:value>20120308133121-0800</ns1trim:value></ns1trim:TS></ns1trim:effectiveTime><ns1trim:participation name=\"subject\" typeCode=\"SBJ\"><ns1trim:role classCode=\"PAT\"><ns1trim:bind application=\"echr\"><ns1trim:placeholder><ns1trim:path>echr:patient</ns1trim:path></ns1trim:placeholder></ns1trim:bind><ns1trim:bind application=\"ephr\"><ns1trim:placeholder><ns1trim:path>ephr:patient</ns1trim:path></ns1trim:placeholder></ns1trim:bind><ns1trim:id><ns1trim:II><ns1trim:root>1.2.1.47003</ns1trim:root><ns1trim:extension>echr:patient-2003014</ns1trim:extension></ns1trim:II></ns1trim:id><ns1trim:player classCode=\"PSN\" determinerCode=\"INSTANCE\"><ns1trim:name><ns1trim:label>Patient Name</ns1trim:label><ns1trim:EN><ns1trim:label>Legal Name</ns1trim:label><ns1trim:use>L</ns1trim:use><ns1trim:part><ns1trim:label>First Name</ns1trim:label><ns1trim:type>GIV</ns1trim:type><ns1trim:ST>cherryupd04153</ns1trim:ST></ns1trim:part><ns1trim:part><ns1trim:label>Middle Name</ns1trim:label><ns1trim:type>GIV</ns1trim:type><ns1trim:ST/></ns1trim:part><ns1trim:part><ns1trim:label>Last Name</ns1trim:label><ns1trim:type>FAM</ns1trim:type><ns1trim:ST>Blossom04153</ns1trim:ST></ns1trim:part></ns1trim:EN></ns1trim:name></ns1trim:player></ns1trim:role></ns1trim:participation><ns1trim:participation name=\"dataEnterer\" typeCode=\"ENT\"><ns1trim:role classCode=\"ROL\"><ns1trim:id><ns1trim:II><ns1trim:root>1.2.1.47003</ns1trim:root><ns1trim:extension>sarah.davis@ucsfmedctr.org</ns1trim:extension></ns1trim:II></ns1trim:id></ns1trim:role></ns1trim:participation><ns1trim:relationship direction=\"IN\" enabled=\"true\" name=\"RandomPatientID\" typeCode=\"NAME\"><ns1trim:act classCode=\"OBS\" moodCode=\"EVN\"><ns1trim:bind application=\"echr\" phase=\"create\"><ns1trim:placeholder bindAction=\"create\"><ns1trim:path>echr:patient:trial</ns1trim:path></ns1trim:placeholder></ns1trim:bind><ns1trim:id><ns1trim:II><ns1trim:root>1.2.1.47003</ns1trim:root><ns1trim:extension>echr:patient-2003014:trial-2672222</ns1trim:extension></ns1trim:II></ns1trim:id><ns1trim:title><ns1trim:ST>I-SPY 2 Subject ID</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>Patient ID</ns1trim:label><ns1trim:ST>47724</ns1trim:ST></ns1trim:value><ns1trim:value><ns1trim:label>Study ID</ns1trim:label><ns1trim:ST>6482</ns1trim:ST><!--<ns1trim:ST>I-SPY 2 TRIAL</ns1trim:ST>--></ns1trim:value><ns1trim:value><ns1trim:label>Patient Name</ns1trim:label><ns1trim:ST>201204153</ns1trim:ST></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"patientName\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Patient Name</ns1trim:ST></ns1trim:title><ns1trim:relationship direction=\"IN\" enabled=\"false\" name=\"firstName\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:code><ns1trim:CD><ns1trim:code>184095009</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:code><ns1trim:observation><ns1trim:value><ns1trim:label>First</ns1trim:label><ns1trim:ST>cherryupd04153</ns1trim:ST></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"middleName\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:code><ns1trim:CD><ns1trim:code>405622006</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:code><ns1trim:observation><ns1trim:value><ns1trim:label>Middle</ns1trim:label><ns1trim:ST/></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" enabled=\"false\" name=\"lastName\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:code><ns1trim:CD><ns1trim:code>397678008</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:code><ns1trim:observation><ns1trim:value><ns1trim:label>Last</ns1trim:label><ns1trim:ST>Blossom04153</ns1trim:ST></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" enabled=\"false\" name=\"initials\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:code><ns1trim:CD><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:code><ns1trim:observation><ns1trim:value><ns1trim:label>Initials</ns1trim:label><ns1trim:ST>CB</ns1trim:ST></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" enabled=\"true\" name=\"otherInfo\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Other Information</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>Race</ns1trim:label><ns1trim:valueSet>race</ns1trim:valueSet><ns1trim:SETCE><ns1trim:displayName>White</ns1trim:displayName><ns1trim:code>2567335</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>CADSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:SETCE><ns1trim:CD><ns1trim:code>103579009 | race |</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value><ns1trim:value><ns1trim:label>Ethnicity</ns1trim:label><ns1trim:valueSet>ethnicity</ns1trim:valueSet><ns1trim:CE><ns1trim:displayName>Not Hispanic or Latino</ns1trim:displayName><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion></ns1trim:CE><ns1trim:CD><ns1trim:code>364699009</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>2002440</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value><ns1trim:value><ns1trim:label>SSN</ns1trim:label><ns1trim:ST>123-45-8985</ns1trim:ST><ns1trim:CD><ns1trim:code>398093005</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value><ns1trim:value><ns1trim:label>Institution</ns1trim:label><ns1trim:originalText>QU</ns1trim:originalText><ns1trim:ST>DCP</ns1trim:ST></ns1trim:value></ns1trim:observation><ns1trim:relationship direction=\"IN\" enabled=\"false\" name=\"gender\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:code><ns1trim:CD><ns1trim:code>263495000</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:code><ns1trim:title><ns1trim:ST>Male</ns1trim:ST></ns1trim:title><ns1trim:relationship direction=\"IN\" enabled=\"true\" name=\"genderStatus\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"/></ns1trim:relationship></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"mrn\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:code><ns1trim:CD><ns1trim:code>398225001</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:code><ns1trim:observation><ns1trim:value><ns1trim:label>MRN</ns1trim:label><ns1trim:ST>777025</ns1trim:ST></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"country\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:observation><ns1trim:value><ns1trim:label>Country of birth</ns1trim:label><ns1trim:ST/></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"address\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Patient Address</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>Zip</ns1trim:label><ns1trim:ST/></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"registration\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Registration</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>Registration Date</ns1trim:label><ns1trim:TS><ns1trim:value>20120307</ns1trim:value></ns1trim:TS></ns1trim:value><ns1trim:value><ns1trim:label>Study Coordinator</ns1trim:label><ns1trim:valueSet>studyCoordinator</ns1trim:valueSet><ns1trim:CD><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"studyStaff\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Study Staff</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>Oncologist</ns1trim:label><ns1trim:valueSet>oncologist</ns1trim:valueSet><ns1trim:CD><ns1trim:code>309295000</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value><ns1trim:value><ns1trim:label>Surgeon</ns1trim:label><ns1trim:valueSet>surgeon</ns1trim:valueSet><ns1trim:CD><ns1trim:code>304292004</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value></ns1trim:observation><ns1trim:relationship direction=\"IN\" name=\"clinicalCoordinator\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:observation><ns1trim:value><ns1trim:label>Clinical Coordinator</ns1trim:label><ns1trim:valueSet>clinicalCoordinator</ns1trim:valueSet><ns1trim:CD><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value><ns1trim:value><ns1trim:label>Phone</ns1trim:label><ns1trim:ST/></ns1trim:value><ns1trim:value><ns1trim:label>Fax</ns1trim:label><ns1trim:ST/></ns1trim:value><ns1trim:value><ns1trim:label>Email</ns1trim:label><ns1trim:ST/></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"radiologyCoordinator\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:observation><ns1trim:value><ns1trim:label>Radiology Coordinator</ns1trim:label><ns1trim:valueSet>radiologyCoordinator</ns1trim:valueSet><ns1trim:CD><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CD></ns1trim:value><ns1trim:value><ns1trim:label>Phone</ns1trim:label><ns1trim:ST/></ns1trim:value><ns1trim:value><ns1trim:label>Fax</ns1trim:label><ns1trim:ST/></ns1trim:value><ns1trim:value><ns1trim:label>Email</ns1trim:label><ns1trim:ST/></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"legalDates\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Legal / Dates</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>IRB Approval Date</ns1trim:label><ns1trim:TS><ns1trim:value>20120307</ns1trim:value></ns1trim:TS></ns1trim:value><ns1trim:value><ns1trim:label>Screening Informed Consent Date</ns1trim:label><ns1trim:TS><ns1trim:value>20120307</ns1trim:value></ns1trim:TS></ns1trim:value><ns1trim:value><ns1trim:label>HIPAA Consent Date</ns1trim:label><ns1trim:TS><ns1trim:value>20120307</ns1trim:value></ns1trim:TS></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"caTissueStatus\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:bind application=\"echr\" phase=\"create\"><ns1trim:placeholder bindAction=\"create\"><ns1trim:path>echr:patient:caseReportForm:caTissueValues</ns1trim:path></ns1trim:placeholder></ns1trim:bind><ns1trim:id><ns1trim:II><ns1trim:root>1.2.1.47003</ns1trim:root><ns1trim:extension>echr:patient-2003014:caseReportForm-2672221:caTissueValues-2672223</ns1trim:extension></ns1trim:II></ns1trim:id><ns1trim:title><ns1trim:ST>caTissueStatus</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:INT><ns1trim:label>Participant not created yet</ns1trim:label><ns1trim:value>0</ns1trim:value></ns1trim:INT></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:relationship direction=\"IN\" name=\"patientDOB\" typeCode=\"NAME\"><ns1trim:act classCode=\"ENTRY\" moodCode=\"EVN\"><ns1trim:title><ns1trim:ST>Patient DOB</ns1trim:ST></ns1trim:title><ns1trim:observation><ns1trim:value><ns1trim:label>Patient DOB: </ns1trim:label><ns1trim:TS><ns1trim:value>1965-11-24</ns1trim:value></ns1trim:TS></ns1trim:value></ns1trim:observation></ns1trim:act></ns1trim:relationship><ns1trim:compute><ns1trim:type>org.tolven.process.RandomIDGenerator</ns1trim:type><ns1trim:property name=\"enabled\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:boolean\">false</ns1trim:value></ns1trim:property><ns1trim:property name=\"path\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">echr:patients:trials</ns1trim:value></ns1trim:property></ns1trim:compute><ns1trim:compute><ns1trim:type>org.tolven.process.CRFPrior</ns1trim:type><ns1trim:property name=\"enabled\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:boolean\">false</ns1trim:value></ns1trim:property><ns1trim:property name=\"action\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">registration</ns1trim:value></ns1trim:property><ns1trim:property name=\"path\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">echr:patients:all</ns1trim:value></ns1trim:property></ns1trim:compute><ns1trim:compute><ns1trim:type>org.tolven.process.CRFPrior</ns1trim:type><ns1trim:property name=\"computeEnabled\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:boolean\">true</ns1trim:value></ns1trim:property><ns1trim:property name=\"action\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">caTissue</ns1trim:value></ns1trim:property><ns1trim:property name=\"path\"><ns1trim:value xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"xs:string\">echr:patient:caseReportForms:caTissueValueList</ns1trim:value></ns1trim:property></ns1trim:compute></ns1trim:act><ns1trim:valueSet name=\"race\"><ns1trim:CE><ns1trim:displayName>American Indian or Alaska Native</ns1trim:displayName><ns1trim:code>2561140</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Asian</ns1trim:displayName><ns1trim:code>2567338</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Black or African American</ns1trim:displayName><ns1trim:code>2561248</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Native Hawaiian or Other Pacific Islander</ns1trim:displayName><ns1trim:code>20140003 | Hawaiians |</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>2567339</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CE><ns1trim:CE><ns1trim:displayName>White</ns1trim:displayName><ns1trim:code>2567335</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>CADSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"ethnicity\"><ns1trim:CE><ns1trim:displayName>Hispanic or Latino</ns1trim:displayName><ns1trim:code>414408004</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>2581176</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Not Hispanic or Latino</ns1trim:displayName><ns1trim:code>TBD</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem><ns1trim:codeSystemName>SNOMED CT</ns1trim:codeSystemName><ns1trim:codeSystemVersion>January 2009</ns1trim:codeSystemVersion><ns1trim:translation><ns1trim:code>2567110</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.3.26.2</ns1trim:codeSystem><ns1trim:codeSystemName>caDSR</ns1trim:codeSystemName><ns1trim:codeSystemVersion>2.1</ns1trim:codeSystemVersion></ns1trim:translation></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"staff\"><ns1trim:CE><ns1trim:displayName>Staff 1</ns1trim:displayName><ns1trim:code>C0024579</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.56</ns1trim:codeSystem><ns1trim:codeSystemVersion>2007AA</ns1trim:codeSystemVersion></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Staff 2</ns1trim:displayName><ns1trim:code>C0024580</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.56</ns1trim:codeSystem><ns1trim:codeSystemVersion>2007AA</ns1trim:codeSystemVersion></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Staff 3</ns1trim:displayName><ns1trim:code>C0024581</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.56</ns1trim:codeSystem><ns1trim:codeSystemVersion>2007AA</ns1trim:codeSystemVersion></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"oncologist\"><ns1trim:CE><ns1trim:displayName>Rugo, Hope </ns1trim:displayName><ns1trim:code>3092950000</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Esserman , Laura </ns1trim:displayName><ns1trim:code>3092950001</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Alvarado, Michael </ns1trim:displayName><ns1trim:code>3092950002</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Ewing, Cheryl </ns1trim:displayName><ns1trim:code>3092950003</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Hwang, Shelley </ns1trim:displayName><ns1trim:code>3092950004</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName> Melisko, Michelle </ns1trim:displayName><ns1trim:code>3092950005</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Chien, Jo </ns1trim:displayName><ns1trim:code>3092950006</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Moasser, Mark  </ns1trim:displayName><ns1trim:code>3092950007</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Munster, Pamela </ns1trim:displayName><ns1trim:code>3092950008</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Park, John </ns1trim:displayName><ns1trim:code>3092950009</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"surgeon\"><ns1trim:CE><ns1trim:displayName>Rugo, Hope </ns1trim:displayName><ns1trim:code>3042920040</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Esserman , Laura </ns1trim:displayName><ns1trim:code>3042920041</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Alvarado, Michael </ns1trim:displayName><ns1trim:code>3042920042</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Ewing, Cheryl </ns1trim:displayName><ns1trim:code>3042920043</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Hwang, Shelley </ns1trim:displayName><ns1trim:code>3042920044</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName> Melisko, Michelle </ns1trim:displayName><ns1trim:code>3042920045</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Chien, Jo </ns1trim:displayName><ns1trim:code>3042920046</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Moasser, Mark  </ns1trim:displayName><ns1trim:code>3042920047</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Munster, Pamela </ns1trim:displayName><ns1trim:code>3042920048</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>Park, John </ns1trim:displayName><ns1trim:code>3042920049</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"clinicalCoordinator\"><ns1trim:CE><ns1trim:displayName>Lyandres, Julia </ns1trim:displayName><ns1trim:code>TBD0</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName> Watkins, Margarita </ns1trim:displayName><ns1trim:code>TBD1</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>D'Andrea, Carrie </ns1trim:displayName><ns1trim:code>TBD2</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"radiologyCoordinator\"><ns1trim:CE><ns1trim:displayName>Lyandres, Julia </ns1trim:displayName><ns1trim:code>TBD0</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName> Watkins, Margarita </ns1trim:displayName><ns1trim:code>TBD1</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>D'Andrea, Carrie </ns1trim:displayName><ns1trim:code>TBD2</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE></ns1trim:valueSet><ns1trim:valueSet name=\"studyCoordinator\"><ns1trim:CE><ns1trim:displayName>Lyandres, Julia </ns1trim:displayName><ns1trim:code>TBD0</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName> Watkins, Margarita </ns1trim:displayName><ns1trim:code>TBD1</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE><ns1trim:CE><ns1trim:displayName>D'Andrea, Carrie </ns1trim:displayName><ns1trim:code>TBD2</ns1trim:code><ns1trim:codeSystem>2.16.840.1.113883.6.5</ns1trim:codeSystem></ns1trim:CE></ns1trim:valueSet></ns1trim:trim></mes:businessMessagePayload></mes:request></mes:caXchangeRequestMessage>";
    }
}
