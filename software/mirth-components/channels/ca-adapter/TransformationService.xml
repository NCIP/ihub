<com.webreach.mirth.model.Channel>
  <id>ab844eb1-6945-4114-99d0-0f2eb366076c</id>
  <name>TransformationService</name>
  <description></description>
  <enabled>true</enabled>
  <version>1.8.2</version>
  <lastModified>
    <time>1287677541875</time>
    <timezone>America/New_York</timezone>
  </lastModified>
  <revision>41</revision>
  <sourceConnector>
    <name>sourceConnector</name>
    <properties>
      <property name="port">8081</property>
      <property name="listenerAddress">localhost</property>
      <property name="useListenerAddress">1</property>
      <property name="DataType">SOAP Listener</property>
      <property name="serviceName">TransformationService</property>
      <property name="externalAddress">localhost</property>
      <property name="Content-Type">text/xml</property>
      <property name="host">axis:soap://localhost:8081/services</property>
      <property name="responseValue">SOAPResponse</property>
    </properties>
    <transformer>
      <steps/>
      <inboundTemplate>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#x0D;
&lt;request&gt;&#x0D;
    &lt;metadata&gt;&#x0D;
		&lt;uid&gt;66b20b26-dc51-11df-9972-ddc780619c0d&lt;/uid&gt;
        &lt;sourceformat&gt;DELIMITED&lt;/sourceformat&gt;&#x0D;
        &lt;targetformat&gt;HL7V3&lt;/targetformat&gt;&#x0D;
    &lt;/metadata&gt;&#x0D;
    &lt;payload&gt;Tiger,Woods,08/20/1968,Male,Duke&lt;/payload&gt;&#x0D;
&lt;/request&gt;</inboundTemplate>
      <outboundTemplate></outboundTemplate>
      <inboundProtocol>XML</inboundProtocol>
      <outboundProtocol>XML</outboundProtocol>
      <inboundProperties/>
      <outboundProperties/>
    </transformer>
    <filter>
      <rules/>
    </filter>
    <transportName>SOAP Listener</transportName>
    <mode>SOURCE</mode>
    <enabled>true</enabled>
  </sourceConnector>
  <destinationConnectors>
    <com.webreach.mirth.model.Connector>
      <name>DELIMITED TO HL7V3</name>
      <properties>
        <property name="DataType">Channel Writer</property>
        <property name="synchronised">1</property>
        <property name="template">${payload}</property>
        <property name="host">d42931fd-8269-433c-874e-2caeea9f9e4b</property>
      </properties>
      <transformer>
        <steps>
          <com.webreach.mirth.model.Step>
            <sequenceNumber>0</sequenceNumber>
            <name>payload</name>
            <script>var mapping;try { mapping = msg[&apos;payload&apos;].toString(); }catch (e) { logger.error(e);  mapping = &apos;&apos;;}channelMap.put(&apos;payload&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
            <type>Mapper</type>
            <data class="map">
              <entry>
                <string>Mapping</string>
                <string>msg[&apos;payload&apos;].toString()</string>
              </entry>
              <entry>
                <string>Variable</string>
                <string>payload</string>
              </entry>
              <entry>
                <string>RegularExpressions</string>
                <list/>
              </entry>
              <entry>
                <string>DefaultValue</string>
                <string></string>
              </entry>
              <entry>
                <string>isGlobal</string>
                <string>channel</string>
              </entry>
            </data>
          </com.webreach.mirth.model.Step>
        </steps>
        <inboundTemplate>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#x0D;
&lt;request&gt;&#x0D;
    &lt;metadata&gt;&#x0D;
        &lt;sourceformat&gt;DELIMITED&lt;/sourceformat&gt;&#x0D;
        &lt;targetformat&gt;HL7V3&lt;/targetformat&gt;&#x0D;
    &lt;/metadata&gt;&#x0D;
    &lt;payload&gt;Tiger,Woods,08/20/1968,Male,Duke&lt;/payload&gt;&#x0D;
&lt;/request&gt;&#x0D;</inboundTemplate>
        <outboundTemplate></outboundTemplate>
        <inboundProtocol>XML</inboundProtocol>
        <outboundProtocol>XML</outboundProtocol>
        <inboundProperties/>
        <outboundProperties/>
      </transformer>
      <filter>
        <rules>
          <com.webreach.mirth.model.Rule>
            <sequenceNumber>0</sequenceNumber>
            <name>Accept message if &quot;metadata - sourceformat&quot; equals &apos;DELIMITED&apos;</name>
            <data class="map">
              <entry>
                <string>OriginalField</string>
                <string>msg[&apos;metadata&apos;][&apos;sourceformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Values</string>
                <list>
                  <string>&apos;DELIMITED&apos;</string>
                </list>
              </entry>
              <entry>
                <string>Equals</string>
                <string>1</string>
              </entry>
              <entry>
                <string>Field</string>
                <string>msg[&apos;metadata&apos;][&apos;sourceformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Name</string>
                <string>metadata - sourceformat</string>
              </entry>
              <entry>
                <string>Accept</string>
                <string>1</string>
              </entry>
            </data>
            <type>Rule Builder</type>
            <script>if(msg[&apos;metadata&apos;][&apos;sourceformat&apos;].toString() == &apos;DELIMITED&apos;)
{
return true;
}
return false;</script>
            <operator>NONE</operator>
          </com.webreach.mirth.model.Rule>
          <com.webreach.mirth.model.Rule>
            <sequenceNumber>1</sequenceNumber>
            <name>Accept message if &quot;metadata - targetformat&quot; equals &apos;HL7V3&apos;</name>
            <data class="map">
              <entry>
                <string>OriginalField</string>
                <string>msg[&apos;metadata&apos;][&apos;targetformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Values</string>
                <list>
                  <string>&apos;HL7V3&apos;</string>
                </list>
              </entry>
              <entry>
                <string>Equals</string>
                <string>1</string>
              </entry>
              <entry>
                <string>Field</string>
                <string>msg[&apos;metadata&apos;][&apos;targetformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Name</string>
                <string>metadata - targetformat</string>
              </entry>
              <entry>
                <string>Accept</string>
                <string>1</string>
              </entry>
            </data>
            <type>Rule Builder</type>
            <script>if(msg[&apos;metadata&apos;][&apos;targetformat&apos;].toString() == &apos;HL7V3&apos;)
{
return true;
}
return false;</script>
            <operator>AND</operator>
          </com.webreach.mirth.model.Rule>
        </rules>
      </filter>
      <transportName>Channel Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
    </com.webreach.mirth.model.Connector>
    <com.webreach.mirth.model.Connector>
      <name>XML TO HL7V3</name>
      <properties>
        <property name="DataType">Channel Writer</property>
        <property name="synchronised">1</property>
        <property name="template">${payload}</property>
        <property name="host">17dd3c56-3cc1-4eaa-8fcc-a955048c84b8</property>
      </properties>
      <transformer>
        <steps>
          <com.webreach.mirth.model.Step>
            <sequenceNumber>0</sequenceNumber>
            <name>payload</name>
            <script>var mapping;try { mapping = msg[&apos;payload&apos;].toString(); }catch (e) { logger.error(e);  mapping = &apos;&apos;;}channelMap.put(&apos;payload&apos;, validate( mapping , &apos;&apos;, new Array()));</script>
            <type>Mapper</type>
            <data class="map">
              <entry>
                <string>Mapping</string>
                <string>msg[&apos;payload&apos;].toString()</string>
              </entry>
              <entry>
                <string>Variable</string>
                <string>payload</string>
              </entry>
              <entry>
                <string>RegularExpressions</string>
                <list/>
              </entry>
              <entry>
                <string>DefaultValue</string>
                <string></string>
              </entry>
              <entry>
                <string>isGlobal</string>
                <string>channel</string>
              </entry>
            </data>
          </com.webreach.mirth.model.Step>
        </steps>
        <inboundTemplate>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#x0D;
&lt;request&gt;&#x0D;
    &lt;metadata&gt;&#x0D;
        &lt;sourceformat&gt;DELIMITED&lt;/sourceformat&gt;&#x0D;
        &lt;targetformat&gt;HL7V3&lt;/targetformat&gt;&#x0D;
    &lt;/metadata&gt;&#x0D;
    &lt;payload&gt;Tiger,Woods,08/20/1968,Male,Duke&lt;/payload&gt;&#x0D;
&lt;/request&gt;&#x0D;</inboundTemplate>
        <outboundTemplate></outboundTemplate>
        <inboundProtocol>XML</inboundProtocol>
        <outboundProtocol>XML</outboundProtocol>
        <inboundProperties/>
        <outboundProperties/>
      </transformer>
      <filter>
        <rules>
          <com.webreach.mirth.model.Rule>
            <sequenceNumber>0</sequenceNumber>
            <name>Accept message if &quot;metadata - sourceformat&quot; equals &apos;XML&apos;</name>
            <data class="map">
              <entry>
                <string>OriginalField</string>
                <string>msg[&apos;metadata&apos;][&apos;sourceformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Values</string>
                <list>
                  <string>&apos;XML&apos;</string>
                </list>
              </entry>
              <entry>
                <string>Equals</string>
                <string>1</string>
              </entry>
              <entry>
                <string>Field</string>
                <string>msg[&apos;metadata&apos;][&apos;sourceformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Name</string>
                <string>metadata - sourceformat</string>
              </entry>
              <entry>
                <string>Accept</string>
                <string>1</string>
              </entry>
            </data>
            <type>Rule Builder</type>
            <script>if(msg[&apos;metadata&apos;][&apos;sourceformat&apos;].toString() == &apos;XML&apos;)
{
return true;
}
return false;</script>
            <operator>NONE</operator>
          </com.webreach.mirth.model.Rule>
          <com.webreach.mirth.model.Rule>
            <sequenceNumber>1</sequenceNumber>
            <name>Accept message if &quot;metadata - targetformat&quot; equals &apos;HL7V3&apos;</name>
            <data class="map">
              <entry>
                <string>OriginalField</string>
                <string>msg[&apos;metadata&apos;][&apos;targetformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Values</string>
                <list>
                  <string>&apos;HL7V3&apos;</string>
                </list>
              </entry>
              <entry>
                <string>Equals</string>
                <string>1</string>
              </entry>
              <entry>
                <string>Field</string>
                <string>msg[&apos;metadata&apos;][&apos;targetformat&apos;].toString()</string>
              </entry>
              <entry>
                <string>Name</string>
                <string>metadata - targetformat</string>
              </entry>
              <entry>
                <string>Accept</string>
                <string>1</string>
              </entry>
            </data>
            <type>Rule Builder</type>
            <script>if(msg[&apos;metadata&apos;][&apos;targetformat&apos;].toString() == &apos;HL7V3&apos;)
{
return true;
}
return false;</script>
            <operator>AND</operator>
          </com.webreach.mirth.model.Rule>
        </rules>
      </filter>
      <transportName>Channel Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
    </com.webreach.mirth.model.Connector>
    <com.webreach.mirth.model.Connector>
      <name>Write Response</name>
      <properties>
        <property name="script">//responseMap.put(&apos;SOAPResponse&apos;, ResponseFactory.getSuccessResponse(globalMap.get(messageObject.getId())));
//globalMap.remove(messageObject.getId());

responseMap.put(&apos;SOAPResponse&apos;, ResponseFactory.getSuccessResponse(globalMap.get(&apos;TransformedData&apos;)));

globalMap.remove(&apos;TransformedData&apos;);

//responseMap.put(&apos;SOAPResponse&apos;, ResponseFactory.getSuccessResponse(responseMap.get($(&apos;DELIMITED TO HL7V3&apos;))));
</property>
        <property name="DataType">JavaScript Writer</property>
        <property name="host">sink</property>
      </properties>
      <transformer>
        <steps/>
        <inboundProtocol>XML</inboundProtocol>
        <outboundProtocol>XML</outboundProtocol>
        <inboundProperties/>
      </transformer>
      <filter>
        <rules/>
      </filter>
      <transportName>JavaScript Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
    </com.webreach.mirth.model.Connector>
  </destinationConnectors>
  <properties>
    <property name="initialState">started</property>
    <property name="synchronous">true</property>
    <property name="store_messages">true</property>
    <property name="encryptData">false</property>
    <property name="transactional">false</property>
    <property name="max_message_age">-1</property>
    <property name="dont_store_filtered">false</property>
    <property name="error_messages_only">false</property>
  </properties>
  <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
  <postprocessingScript>// This script executes once after a message has been processed
return;</postprocessingScript>
  <deployScript>// This script executes once when the mule engine is started
// You only have access to the globalMap here to persist data
return;</deployScript>
  <shutdownScript>// This script executes once when the mule engine is stopped
// You only have access to the globalMap here to persist data
return;</shutdownScript>
</com.webreach.mirth.model.Channel>